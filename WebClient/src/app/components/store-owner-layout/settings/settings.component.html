<div id="main">

  <div class="section">
    <fieldset>
      <legend>Account Information</legend>
      
      <!-- Success message display -->
      <div *ngIf="successMessage" class="success-message">
        {{ successMessage }}
      </div>
      
      <form [formGroup]="profileForm">
        <div class="form-row">
          <div class="form-group">
            <label for="FirstName">First Name</label>
            <input 
              type="text" 
              id="FirstName" 
              formControlName="FirstName" 
              [readonly]="!isEditing"
              [class.is-invalid]="profileForm.get('FirstName')?.invalid && (profileForm.get('FirstName')?.dirty || profileForm.get('FirstName')?.touched)"
              placeholder="Enter your first name">
            <div *ngIf="profileForm.get('FirstName')?.invalid && (profileForm.get('FirstName')?.dirty || profileForm.get('FirstName')?.touched)" class="invalid-feedback">
              First name is required
            </div>
          </div>

          <div class="form-group">
            <label for="LastName">Last Name</label>
            <input 
              type="text" 
              id="LastName" 
              formControlName="LastName" 
              [readonly]="!isEditing"
              [class.is-invalid]="profileForm.get('LastName')?.invalid && (profileForm.get('LastName')?.dirty || profileForm.get('LastName')?.touched)"
              placeholder="Enter your last name">
            <div *ngIf="profileForm.get('LastName')?.invalid && (profileForm.get('LastName')?.dirty || profileForm.get('LastName')?.touched)" class="invalid-feedback">
              Last name is required
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="Email">Email</label>
          <input 
            type="text" 
            id="Email" 
            formControlName="Email" 
            readonly
            placeholder="Enter your email">
          <small>Email address cannot be changed</small>
        </div>

        <div class="form-group">
          <label for="Phone">Phone</label>
          <input 
            type="text" 
            id="Phone" 
            formControlName="Phone" 
            [readonly]="!isEditing"
            [class.is-invalid]="profileForm.get('Phone')?.invalid && (profileForm.get('Phone')?.dirty || profileForm.get('Phone')?.touched)"
            placeholder="Enter your phone number">
          <div *ngIf="profileForm.get('Phone')?.invalid && (profileForm.get('Phone')?.dirty || profileForm.get('Phone')?.touched)" class="invalid-feedback">
            Valid phone number is required
          </div>
        </div>

        <div class="form-group">
          <label for="DOB">Date of Birth</label>
          <input 
            type="date" 
            id="DOB" 
            formControlName="DOB" 
            [readonly]="!isEditing">
        </div>

        <div class="form-group full-width">
          <label for="Address">Address</label>
          <input 
            type="text" 
            id="Address" 
            formControlName="Address" 
            [readonly]="!isEditing"
            [class.is-invalid]="profileForm.get('Address')?.invalid && (profileForm.get('Address')?.dirty || profileForm.get('Address')?.touched)"
            placeholder="Enter your address">
          <div *ngIf="profileForm.get('Address')?.invalid && (profileForm.get('Address')?.dirty || profileForm.get('Address')?.touched)" class="invalid-feedback">
            Address is required
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="City">City</label>
            <input 
              type="text" 
              id="City" 
              formControlName="City" 
              [readonly]="!isEditing"
              [class.is-invalid]="profileForm.get('City')?.invalid && (profileForm.get('City')?.dirty || profileForm.get('City')?.touched)"
              placeholder="Enter your city">
            <div *ngIf="profileForm.get('City')?.invalid && (profileForm.get('City')?.dirty || profileForm.get('City')?.touched)" class="invalid-feedback">
              City is required
            </div>
          </div>

          <div class="form-group">
            <label for="State">State/Province</label>
            <input 
              type="text" 
              id="State" 
              formControlName="State" 
              [readonly]="!isEditing"
              [class.is-invalid]="profileForm.get('State')?.invalid && (profileForm.get('State')?.dirty || profileForm.get('State')?.touched)"
              placeholder="Enter your state/province">
            <div *ngIf="profileForm.get('State')?.invalid && (profileForm.get('State')?.dirty || profileForm.get('State')?.touched)" class="invalid-feedback">
              State/Province is required
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="PostalCode">Postal/Zip Code</label>
            <input 
              type="text" 
              id="PostalCode" 
              formControlName="PostalCode" 
              [readonly]="!isEditing"
              [class.is-invalid]="profileForm.get('PostalCode')?.invalid && (profileForm.get('PostalCode')?.dirty || profileForm.get('PostalCode')?.touched)"
              placeholder="Enter your postal/zip code">
            <div *ngIf="profileForm.get('PostalCode')?.invalid && (profileForm.get('PostalCode')?.dirty || profileForm.get('PostalCode')?.touched)" class="invalid-feedback">
              Postal/Zip code is required
            </div>
          </div>

          <div class="form-group">
            <label for="Country">Country</label>
            <input 
              type="text" 
              id="Country" 
              formControlName="Country" 
              [readonly]="!isEditing"
              [class.is-invalid]="profileForm.get('Country')?.invalid && (profileForm.get('Country')?.dirty || profileForm.get('Country')?.touched)"
              placeholder="Enter your country">
            <div *ngIf="profileForm.get('Country')?.invalid && (profileForm.get('Country')?.dirty || profileForm.get('Country')?.touched)" class="invalid-feedback">
              Country is required
            </div>
          </div>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="Subscribed" [disabled]="!isEditing">
            <span>Subscribe to newsletter and promotions</span>
          </label>
        </div>
      </form>

      <div *ngIf="errorMessage" class="invalid-feedback">
        {{ errorMessage }}
      </div>

      <div class="button-group">
        <button *ngIf="!isEditing" id="edit-btn" class="standard-button primary" (click)="toggleEdit()">Edit</button>
        <button *ngIf="isEditing" id="save-btn" class="standard-button primary" (click)="saveProfile()" [disabled]="isSaving || profileForm.invalid">
          <span *ngIf="!isSaving">Save</span>
          <span *ngIf="isSaving">Saving...</span>
        </button>
        <button *ngIf="isEditing" class="standard-button secondary" (click)="toggleEdit()" [disabled]="isSaving">Cancel</button>
      </div>
    </fieldset>
  </div>

  <div class="section">
    <fieldset>
      <legend>Payment Information</legend>
      
      <form [formGroup]="paymentForm">
        <div class="form-group">
          <label for="PaymentMethod">Payment Method</label>
          <select id="PaymentMethod" formControlName="PaymentMethod" [disabled]="true">
            <option value="credit">Credit Card</option>
            <option value="debit">Debit Card</option>
            <option value="paypal">PayPal</option>
          </select>
          <small>Payment method can only be updated during checkout</small>
        </div>

        <div class="form-group">
          <label for="CardNumber">Card Number</label>
          <input 
            type="text" 
            id="CardNumber" 
            formControlName="CardNumber" 
            readonly
            placeholder="Card number">
          <small>For security reasons, only the last four digits are displayed</small>
        </div>

        <div class="form-group">
          <label for="CardExpiryDate">Card Expiry Date</label>
          <input 
            type="text" 
            id="CardExpiryDate" 
            formControlName="CardExpiryDate" 
            readonly
            placeholder="MM/YY">
        </div>
      </form>
      
      <div class="payment-info-note">
        <p>For security reasons, payment information cannot be directly edited here. 
        To update your payment method, please use the checkout process for your next purchase.</p>
      </div>
    </fieldset>
  </div>

  <div class="section save-section">
    <button id="settings-save-btn" class="standard-button primary full-width" (click)="saveSettings()">Save All Settings</button>
  </div>

</div>